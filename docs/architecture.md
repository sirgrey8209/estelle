# Estelle ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ê°œìš”

Estelleì€ ì—¬ëŸ¬ PCì™€ ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ Claude Codeë¥¼ ì›ê²©ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

---

## í†µì‹  êµ¬ì¡°

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Estelle Relay  â”‚
                         â”‚   (Fly.io)      â”‚
                         â”‚   Port 8080     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ WSS (443)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚                        â”‚
   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â”‚  Pylon    â”‚            â”‚  Pylon    â”‚            â”‚  Desktop  â”‚
   â”‚  (ì§‘ PC)  â”‚            â”‚ (íšŒì‚¬ PC) â”‚            â”‚  Mobile   â”‚
   â”‚ deviceId:1â”‚            â”‚ deviceId:2â”‚            â”‚ deviceId: â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ 100+      â”‚
                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì›ì¹™

1. **ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ëŠ” Relayì— ì—°ê²°**
   - Desktop â†’ Relay â†’ Pylon
   - Mobile â†’ Relay â†’ Pylon
   - Pylon â†’ Relay (ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸/Pylonê³¼ í†µì‹ )

2. **RelayëŠ” ìˆœìˆ˜ ë¼ìš°í„°**
   - ë©”ì‹œì§€ ë‚´ìš©ì„ í•´ì„í•˜ì§€ ì•ŠìŒ
   - \`to\`, \`broadcast\` í•„ë“œë§Œ ë³´ê³  ë¼ìš°íŒ…

3. **ë¡œì»¬ í†µì‹  ëª¨ë“œ (í–¥í›„)**
   - Relay ì¥ì•  ì‹œ fallbackìœ¼ë¡œ ê²€í† 
   - Desktop â†’ Pylon (localhost:9000) ì§ì ‘ ì—°ê²°
   - í˜„ì¬ëŠ” ë¯¸êµ¬í˜„

---

## ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 1. Relay (estelle-relay)

**ì—­í• **: ì¤‘ì•™ ë¼ìš°íŒ… ì„œë²„

**ì²˜ë¦¬í•˜ëŠ” ë©”ì‹œì§€**:
- \`auth\` - ì¸ì¦
- \`get_devices\` - ì—°ê²°ëœ ë””ë°”ì´ìŠ¤ ëª©ë¡
- \`ping\` - ì—°ê²° í™•ì¸

**ë¼ìš°íŒ… ê·œì¹™**:
- \`to: { deviceId, deviceType }\` â†’ í•´ë‹¹ ë””ë°”ì´ìŠ¤ë¡œ ì§ì ‘ ì „ì†¡
- \`broadcast: 'all'\` â†’ ëª¨ë“  ì¸ì¦ëœ í´ë¼ì´ì–¸íŠ¸
- \`broadcast: 'pylons'\` â†’ ëª¨ë“  Pylon
- \`broadcast: 'clients'\` â†’ Pylon ì œì™¸ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸
- ê¸°ë³¸: Pylonì´ ë³´ë‚´ë©´ â†’ í´ë¼ì´ì–¸íŠ¸ë“¤ë¡œ, í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ë©´ â†’ Pylonë“¤ë¡œ

### 2. Pylon (estelle-pylon)

**ì—­í• **: PC ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤

**ê¸°ëŠ¥**:
- Relay ì—°ê²° ìœ ì§€
- Claude SDK ì‹¤í–‰ ë° ê´€ë¦¬
- ë°ìŠ¤í¬ ê´€ë¦¬

**ë©”ì‹œì§€ ì²˜ë¦¬**:
- Relayë¡œë¶€í„° ë°›ì€ ë©”ì‹œì§€ ì¤‘ ìì‹ ì—ê²Œ ì˜¨ ê²ƒë§Œ ì²˜ë¦¬
- \`to.deviceId\`ê°€ ìì‹ ì´ë©´ â†’ ë¡œì»¬ ì²˜ë¦¬

### 3. Desktop (estelle-desktop)

**ì—­í• **: PCìš© UI (Electron)

**ì—°ê²°**:
- Relayì— ì§ì ‘ ì—°ê²° (\`wss://estelle-relay.fly.dev\`)
- ë™ì  deviceId ì‚¬ìš© (100+)

**ê¸°ëŠ¥**:
- ëª¨ë“  Pylonì˜ ë°ìŠ¤í¬ ëª©ë¡ í‘œì‹œ (ì§‘/íšŒì‚¬ ë“±)
- Claude ë©”ì‹œì§€ ì†¡ìˆ˜ì‹ 
- ê¶Œí•œ ìš”ì²­ ì‘ë‹µ

### 4. Mobile (estelle-mobile)

**ì—­í• **: Android ì•±

**ì—°ê²°**:
- Relayì— ì§ì ‘ ì—°ê²° (\`wss://estelle-relay.fly.dev\`)
- ë™ì  deviceId ì‚¬ìš© (100+)

**ê¸°ëŠ¥**:
- Desktopê³¼ ë™ì¼

---

## Device ID ì²´ê³„

### ì •ì  ID (1-99)

| deviceId | ì´ë¦„ | ì•„ì´ì½˜ | ì—­í•  |
|----------|------|--------|------|
| 1 | Selene | ğŸŒ™ | ì§‘ PC |
| 2 | Stella | â­ | íšŒì‚¬ PC |

### ë™ì  ID (100+)

Desktop, Mobile ë“± í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ì† ì‹œ ìë™ í• ë‹¹:
\`\`\`
deviceId = 100 + random(0-899)
\`\`\`

---

## ë©”ì‹œì§€ í˜•ì‹

### ê¸°ë³¸ êµ¬ì¡°

\`\`\`json
{
  "type": "ë©”ì‹œì§€_íƒ€ì…",
  "to": { "deviceId": 1, "deviceType": "pylon" },  // ì„ íƒ
  "broadcast": "clients",  // ì„ íƒ
  "payload": { ... }
}
\`\`\`

### ì£¼ìš” ë©”ì‹œì§€ íƒ€ì…

| íƒ€ì… | ë°©í–¥ | ì„¤ëª… |
|------|------|------|
| \`auth\` | â†’ Relay | ì¸ì¦ ìš”ì²­ |
| \`auth_result\` | â† Relay | ì¸ì¦ ê²°ê³¼ |
| \`desk_list\` | â†’ Pylon | ë°ìŠ¤í¬ ëª©ë¡ ìš”ì²­ |
| \`desk_list_result\` | â† Pylon | ë°ìŠ¤í¬ ëª©ë¡ |
| \`claude_send\` | â†’ Pylon | Claude ë©”ì‹œì§€ ì „ì†¡ |
| \`claude_event\` | â† Pylon | Claude ì´ë²¤íŠ¸ (í…ìŠ¤íŠ¸, íˆ´ ë“±) |
| \`claude_permission\` | â†’ Pylon | ê¶Œí•œ ì‘ë‹µ |
| \`claude_control\` | â†’ Pylon | ì œì–´ (stop, new_session) |

### ë°ìŠ¤í¬ ëª©ë¡ ì¡°íšŒ í”Œë¡œìš°

```
1. Desktop/Mobile ì¸ì¦ ì„±ê³µ ì‹œ:
   â†’ { type: 'desk_list', broadcast: 'pylons' }

2. Relayê°€ ëª¨ë“  Pylonì— ë¸Œë¡œë“œìºìŠ¤íŠ¸:
   â†’ ê° Pylonì—ê²Œ { type: 'desk_list', from: { deviceId: 100, ... } }

3. ê° Pylonì´ ì‘ë‹µ:
   â†’ { type: 'desk_list_result', to: { deviceId: 100, deviceType: 'desktop' }, payload: { deviceId, deviceInfo, desks } }
   ë˜ëŠ” broadcast: 'clients'ë¡œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸

4. Desktop/Mobileì´ desk_list_result ìˆ˜ì‹ :
   â†’ deviceIdë³„ë¡œ Mapì— ì €ì¥í•˜ì—¬ ì—¬ëŸ¬ Pylon ë°ìŠ¤í¬ í‘œì‹œ
```

---

## ë¡œê¹… & ë””ë²„ê¹… ì‹œìŠ¤í…œ

### ë¡œê¹…

ëª¨ë“  íŒ¨í‚·ì„ íŒŒì¼ë¡œ ë¡œê¹…:

\`\`\`
logs/
  2024-01-21_14-30-00_recv_auth_result.json
  2024-01-21_14-30-01_send_claude_send.json
\`\`\`

ë¡œê·¸ íŒŒì¼ í˜•ì‹:
\`\`\`json
{
  "timestamp": "2024-01-21T14:30:00.123Z",
  "direction": "recv",  // recv | send
  "source": "relay",    // recv ì‹œ
  "target": "relay",    // send ì‹œ
  "type": "claude_send",
  "data": { ... }
}
\`\`\`

### ì…ë ¥ ì‹œë®¬ë ˆì´ì…˜ (inbox)

ì‹¤í–‰ ì¤‘ì¸ ì•±ì—ì„œ inbox í´ë”ë¥¼ ê°ì‹œ:
\`\`\`
inbox/
  test_message.json  â†’ ë„£ìœ¼ë©´ ì¦‰ì‹œ ì²˜ë¦¬ë¨
processed/
  test_message.json  â†’ ì²˜ë¦¬ í›„ ì´ë™
\`\`\`

**ì¬í˜„ í”Œë¡œìš°**:
1. ë²„ê·¸ ë°œìƒ
2. logs/ í´ë”ì—ì„œ ê´€ë ¨ íŒ¨í‚· í™•ì¸
3. inbox/ì— ë³µì‚¬
4. ì¬í˜„ ì™„ë£Œ

---

## íŒŒì¼ êµ¬ì¡°

\`\`\`
estelle/
â”œâ”€â”€ estelle-relay/       # Relay ì„œë²„ (Fly.io)
â”‚   â””â”€â”€ src/index.js
â”œâ”€â”€ estelle-pylon/       # PC ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.js
â”‚       â”œâ”€â”€ localServer.js
â”‚       â”œâ”€â”€ claudeManager.js
â”‚       â””â”€â”€ deskStore.js
â”œâ”€â”€ estelle-desktop/     # PC UI (Electron + React)
â”‚   â””â”€â”€ src/App.jsx
â”œâ”€â”€ estelle-mobile/      # Android ì•±
â”‚   â””â”€â”€ app/src/main/java/com/nexus/android/
â”‚       â”œâ”€â”€ RelayClient.kt
â”‚       â””â”€â”€ MainViewModel.kt
â”œâ”€â”€ estelle-shared/      # ê³µìœ  íƒ€ì…/ìƒìˆ˜
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ index.d.ts
â”œâ”€â”€ docs/                # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ characters.md
â”‚   â”œâ”€â”€ pc-setup.md
â”‚   â”œâ”€â”€ pylon-commands.md
â”‚   â””â”€â”€ plan-phase2.md
â”œâ”€â”€ wip/                 # ì§„í–‰ ì¤‘ì¸ ì‘ì—…
â”‚   â””â”€â”€ *.md
â””â”€â”€ log/                 # ì™„ë£Œëœ ì‘ì—… ë¡œê·¸
    â””â”€â”€ YYYY-MM-DD-*.md
\`\`\`

---

*Last updated: 2026-01-22*
